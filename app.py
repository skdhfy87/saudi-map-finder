import streamlit as st
import random
import time
from geopy.geocoders import Nominatim

# ุฅุนุฏุงุฏุงุช ุงูุตูุญุฉ
st.set_page_config(page_title="ูุดุงู ุงูููุงูุน ุงููุงุฏุฆุฉ - ุงูุณุนูุฏูุฉ", page_icon="๐", layout="wide")

st.markdown("""
    <style>
    .main {
        background-color: #f5f7f9;
    }
    .stButton>button {
        width: 100%;
        border-radius: 10px;
        height: 3em;
        background-color: #2e7d32;
        color: white;
    }
    </style>
    """, unsafe_allow_name_with_display_headers=True)

st.title("๐ ูุดุงู ุงูููุงูุน ุดุจู ุงูุนูุฑุงููุฉ (ุจุนูุฏุงู ุนู ุงูุชุตููุฑ)")
st.write("ูุฐู ุงูุฃุฏุงุฉ ุชุจุญุซ ุนู ููุงุท ูุฑูุจุฉ ูู ุงููุฏู ูุนูู ุทุฑู ูุฑุนูุฉุ ููููุง ุบุงูุจุงู ูุง ุชููู ุจุนูุฏุฉ ุนู ุชุญุฏูุซุงุช ุชุตููุฑ ุฌูุฌู ุงูููุซูุฉ.")

# ูุงุฆูุฉ ุดุงููุฉ ููุฏู ูููุงุทู ุงูุณุนูุฏูุฉ (ูุฑุชุจุฉ ุฃุจุฌุฏูุงู)
SAUDI_CITIES = [
    "ุงูุฑูุงุถ", "ุฌุฏุฉ", "ููุฉ ุงูููุฑูุฉ", "ุงููุฏููุฉ ุงููููุฑุฉ", "ุงูุฏูุงู", "ุงููููู", "ุงูุทุงุฆู", 
    "ุชุจูู", "ุจุฑูุฏุฉ", "ุฎููุณ ูุดูุท", "ุงูุฌุจูู", "ุญุงุฆู", "ูุฌุฑุงู", "ุญูุฑ ุงูุจุงุทู", "ุฃุจูุง", 
    "ุงูุฎุฑุฌ", "ุงููุฑูุงุช", "ููุจุน", "ุงููุทูู", "ุนููุฒุฉ", "ุณูุงูุง", "ุฌูุฒุงู", "ุงูุธูุฑุงู", 
    "ุงูุจุงุญุฉ", "ุงูุฒููู", "ุงูุฑุณ", "ูุงุฏู ุงูุฏูุงุณุฑ", "ุจูุดุฉ", "ุงููููุฐุฉ", "ุงููุฌูุนุฉ", 
    "ุนุฑุนุฑ", "ุฑูุญุงุก", "ุดุฑูุฑุฉ", "ุทุฑูู", "ุดูุฑุงุก", "ุงูุฃููุงุฌ", "ุงููุฌ", "ุฑุงุจุบ"
]

# ูุงุฌูุฉ ุงููุฏุฎูุงุช
col1, col2 = st.columns(2)

with col1:
    # ูุงุฆูุฉ ุงุฎุชูุงุฑ ุณูุณุฉ ููุงุจูุฉ ููุจุญุซ
    city_choice = st.selectbox("ุงุฎุชุฑ ุงููุฏููุฉ ุฃู ุงุจุญุซ ุนููุง:", sorted(SAUDI_CITIES))

with col2:
    count = st.number_input("ุนุฏุฏ ุงูููุงุท ุงููุทููุจุฉ:", min_value=1, max_value=10, value=5)

distance = st.slider("ูุฏู ุงูุจุนุฏ ุนู ูุฑูุฒ ุงููุฏููุฉ (ูู):", 5, 30, 15)

if st.button("ุชูููุฏ ููุงูุน ููุชุฑุญุฉ"):
    geolocator = Nominatim(user_agent="saudi_quiet_finder_v2")
    
    with st.spinner(f"ุฌุงุฑู ูุณุญ ุฃุทุฑุงู {city_choice}..."):
        location = geolocator.geocode(city_choice + ", Saudi Arabia")
        
        if location:
            base_lat, base_lon = location.latitude, location.longitude
            results_found = 0
            
            # ุนุฑุถ ุงููุชุงุฆุฌ ูู ุดูู ุจุทุงูุงุช (Cards)
            for i in range(count):
                # ูุนุงุฏูุฉ ููุชุญุฑู ูู ุฃุทุฑุงู ุงููุฏููุฉ ูููุณ ูู ูุณุท ุงูุตุญุฑุงุก ุชูุงูุงู
                # ูุณุชุฎุฏู ุฅุฒุงุญุฉ ุจุณูุทุฉ ุชุญุงูู ุงูุฃุญูุงุก ุงูุฌุฏูุฏุฉ ุฃู ุงูุทุฑู ุงููุฑุนูุฉ
                offset = (distance / 111) # ุชุญููู ุงููููููุชุฑุงุช ูุฏุฑุฌุงุช ุฅุญุฏุงุซูุฉ ุชูุฑูุจูุฉ
                
                r_lat = base_lat + random.uniform(-offset, offset)
                r_lon = base_lon + random.uniform(-offset, offset)
                
                # ุฑุงุจุท ุงูุฎุฑูุทุฉ (Street View Metadata check can't be done without API Key, 
                # so we provide the coordinates which are likely unmapped)
                map_link = f"https://www.google.com/maps/search/?api=1&query={r_lat},{r_lon}"
                
                with st.container():
                    st.markdown(f"---")
                    c1, c2 = st.columns([3, 1])
                    with c1:
                        st.markdown(f"### ูููุน ููุชุฑุญ {i+1}")
                        st.write(f"ุฅุญุฏุงุซูุงุช ุชูุฑูุจูุฉ: `{r_lat:.5f}, {r_lon:.5f}`")
                        st.caption("ูุฐุง ุงููููุน ููุน ูู ุฃุทุฑุงู ุงููุฏููุฉุ ูุบุงูุจุงู ูุง ุชูุชูุฑ ูุฐู ุงูููุงุทู ูุชุตููุฑ Street View ุงูุญุฏูุซ.")
                    with c2:
                        st.link_button("ูุชุญ ุงูุฎุฑูุทุฉ ๐บ๏ธ", map_link)
                
                time.sleep(0.1) # ูุชุฌูุจ ุญุธุฑ ุงูุฎุฏูุฉ ุงููุฌุงููุฉ
        else:
            st.error("ูู ูุชููู ูู ุงูุนุซูุฑ ุนูู ุฅุญุฏุงุซูุงุช ูุฐู ุงููุฏููุฉุ ุญุงูู ูุฑุฉ ุฃุฎุฑู.")

st.sidebar.markdown("""
### ููู ูุนูู ุงููููุนุ
ูุญู ูููู ุจุชูููุฏ ููุงุท ุฌุบุฑุงููุฉ ูู **ูุทุงู ุฃุทุฑุงู ุงููุฏููุฉ** ุงููุญุฏุฏุฉ. 
ุจูุง ุฃู ุฌูุฌู ูุงุจ ูุฑูุฒ ุชุตููุฑู (Street View) ุนูู ุงูุดูุงุฑุน ุงูุฑุฆูุณูุฉ ููุณุท ุงููุฏูุ ูุฅู ูุฐู ุงูููุงุท ุงูุนุดูุงุฆูุฉ ูู ุงูุฃุทุฑุงู ุชููู "ุจุนูุฏุฉ ุนู ุงููุงููุฑุง" ุจูุณุจุฉ ูุจูุฑุฉ.
""")
